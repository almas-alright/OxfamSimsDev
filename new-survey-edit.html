<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
        <title>Home</title>
        <!-- Font Awesome -->
        <link href="css/font-awesome.min.css" rel="stylesheet">
        <!-- Bootstrap -->
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/mdb.min.css" rel="stylesheet">
        <link href="css/style.css" rel="stylesheet">



    </head>

    <body>
        <!-- SideNav slide-out button -->
        <a href="#" data-activates="slide-out" class="navbar-brand button-collapse"><i class="material-icons">menu</i></a>
        <!--/. SideNav slide-out button -->

        <!-- Sidebar navigation -->
        <div id="slide-out" class="side-nav default-side-nav light-side-nav">
            <!-- Logo -->
            <div class="logo-wrapper text-center">
                <a href="index.html"><img src="images/oxfam-logo.png" alt=""></a>
            </div>

            <!-- Side navigation links -->
            <ul class="collapsible collapsible-accordion">
                <li><a href="project-information.html" class="waves-effect waves-light"><i class="fa fa-info-circle"></i>
                        Project information </a></li>
                <li><a href="beneficiary-survey.html" class="waves-effect waves-light"><i class="fa fa-pencil-square-o"></i>
                        Beneficiary Survey </a></li>
                <li><a href="beneficiary-registration.html" class="waves-effect waves-light"><i class="fa fa-plus"></i>
                        Beneficiary Registration</a></li>
                <li><a href="grant-relief-distribution.html" class="waves-effect waves-light"><i class="fa fa-cubes"></i>
                        Grant/Relief Distribution </a></li>
                <li><a href="post-distribution-monitoring.html" class="waves-effect waves-light"><i class="fa fa-eye"></i> Post
                        Distribution Monitoring </a></li>
                <li><a href="sms-attendance.html" class="waves-effect waves-light"><i class="fa fa-envelope-o"></i> SMS
                        Attendance</a></li>
                <li><a href="my-task.html" class="waves-effect waves-light"><i class="fa fa-tasks"></i> My Task </a></li>
                <li><a href="monitoring-supervision.html" class="waves-effect waves-light"><i class="fa fa-search-plus"></i>
                        Monitoring/Supervision </a></li>
                <li><a href="data-management.html" class="waves-effect waves-light"><i class="fa fa-database"></i> Data
                        Management </a></li>
                <li><a href="operational-settings.html" class="waves-effect waves-light"><i class="fa fa-wrench"></i>
                        Operational SettingsÂ  </a></li>

            </ul>
            <!--/. Side navigation links -->

        </div>
        <!--/. Sidebar navigation -->
        <nav class="double-navbar navbar navbar-fixed-top light-green darken-3 z-depth-1">

            <div class="container ">


                <header>
                    <div class="row">
                        <div class="col-xs-3 text-center">
                            <div class="navbar-header pull-left">
                                <!-- SideNav slide-out button -->
                                <a href="#" data-activates="slide-out" class="button-collapse"><i class="fa fa-bars"></i></a>
                                <!--/. SideNav slide-out button -->

                            </div>
                        </div>
                        <div class="col-xs-6 text-center">
                            <h4 class="app-title">SIMS</h4>
                        </div>
                        <div class="col-xs-3 text-center"><a href="index.html"><img src="images/oxfam-logo.png" alt=""></a>
                        </div>
                    </div>

                    <!--row-->
                </header>
            </div>
        </nav>
        <div class="container">

            <section class="page-content">
                <div class="row">
                    <div class="col-sm-12">
                        <h5 class="page-title">New Beneficiary Registration</h5>

                    </div>
                    <!--col-sm-12-->
                </div>
                <!--  row-->
                <div class="row">
                    <div class="col-lg-12">

                        <div class="btn-group btn-group-justified" role="group" aria-label="...">                            
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-info waves-effect waves-light">Load</button>
                            </div>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-warning waves-effect waves-light">Edit</button>
                            </div>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-danger waves-effect waves-light">Del</button>
                            </div>

                        </div>
                    </div>
                    <!--col-sm-12-->
                </div>
                <!--  row-->

                <div class="card-panel">

                    <form class="form">
                        <div class="row">
                            <div class="input-field col-xs-7">
                                <input id="select_id" type="hidden" class="validate">
<!--                                <label for="select_id">ID</label>-->
                            </div>
<!--                            <div class="col-xs-5">
                                <button type="button" class="btn btn-link">Select</button>
                            </div>-->
                        </div>
                        <div class="row">
                            <div class="input-field col-md-12">
                                <input name="office_id" id="office_id" type="hidden" > 
                                <input name="project_id" id="project_id" type="hidden" >
                            </div>
                        </div>


                        <div class="row">
                            <div class="input-field col-md-12">
                                <input id="response_by" type="text" class="validate">
                                <label for="response_by">Group </label>
                            </div>

                        </div>


                        <div class="row">
                            <div class="input-field col-md-12">
                                <input id="beneficiary_name" type="text" class="validate">
                                <label for="beneficiary_name">Beneficiary </label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col-md-12">
                                <input id="nid_num" type="text" class="validate">
                                <label for="nid_num">National Id</label>
                            </div>

                        </div>
                        <div class="row">
                            <div class="col-sm-12">
                                <h6>Photos</h6>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-12">
                                <h6>Beneficiary Image</h6>
                            </div>
                            <div class="col-xs-4 text-center">
                                <button type="button" data-toggle="modal" data-target="#myModal" data-source="#benificiaryPhoto"  class="btn btn-sm btn-link set-image">Set Image</button>
                            </div>
                            <div class="col-xs-4 text-center">
                                <img id="benificiaryPhoto" style="width:60px;height:60px;" class="text-center" src="images/demo-photo.jpg" alt="">
                            </div>

                        </div>                        

                        <div class="row">
                            <div class="col-sm-12">
                                <h6>National id Front Image</h6>
                            </div>
                            <div class="col-xs-4 text-center">

                                <button type="button" data-toggle="modal" data-target="#myModal" data-source="#nid-front"  class="btn btn-sm btn-link set-image">Set Image</button>
                            </div>
                            <div class="col-xs-4 text-center">
                                <img id="nid-front" style="width:60px;height:60px;" class="text-center" src="images/demo-photo.jpg" alt="">

                            </div>

                        </div>

                        <div class="row">
                            <div class="col-sm-12">
                                <h6>National id Back Image</h6>
                            </div>
                            <div class="col-xs-4 text-center">

                                <button type="button" data-toggle="modal" data-target="#myModal" data-source="#nid-back"  class="btn btn-sm btn-link set-image">Set Image</button>
                            </div>
                            <div class="col-xs-4 text-center">
                                <img id="nid-back" style="width:60px;height:60px;" class="text-center" src="images/demo-photo.jpg" alt="">

                            </div>                            
                        </div>




                        <div class="row">
                            <div class="input-field col-md-12">
                                <input id="fathers_name" type="text" class="validate">
                                <label for="fathers_name">Father</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col-md-12">
                                <input id="mothers_name" type="text" class="validate">
                                <label for="mothers_name">Mother</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col-md-12">
                                <input id="union_name" type="text" class="validate">
                                <label for="union_name">Union</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col-md-12">
                                <input id="word_name" type="text" class="validate">
                                <label for="word_name">Ward</label>
                            </div>
                        </div>

                        <div class="row">
                            <div class="input-field col-md-12">
                                <input id="address" type="text" class="validate">
                                <label for="address">Address </label>
                            </div>
                        </div>




                        <div class="row">
                            <div class="input-field col-md-6">
                                <input type="text" id="gender" />
                                <label for="gender">Gender</label>
                            </div>
                            <div class="input-field col-xs-6">
                                <input id="age" type="number" class="validate">
                                <label for="age">Age  </label>
                            </div>
                        </div>


                        <div class="row">
                            <div class="input-field col-md-12">
                                <input id="mobile_no" type="number" class="validate">
                                <label for="mobile_no">Mobile No</label>
                            </div>
                        </div>




                        <div class="row">
                            <div class="input-field col-md-12">
                                <input id="nominee_name" type="text" class="validate">
                                <label for="nominee_name">Nominee</label>
                            </div>
                        </div>

                        <div class="row">
                            <div class="input-field col-md-12">
                                <input id="nominee_father" type="text" class="validate">
                                <label for="nominee_father">Nominee Father Name</label>
                            </div>
                        </div>

                        <div class="row">
                            <div class="input-field col-md-12">
                                <input id="nominee_mother" type="text" class="validate">
                                <label for="nominee_mother">Nominee Mother Name</label>
                            </div>
                        </div>

                        <div class="row">
                            <div class="input-field col-md-12">
                                <input id="relation_with_nom" type="text" class="validate">
                                <label for="relation_with_nom">Relation</label>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-sm-12">
                                <h6>Nominee Photo</h6>
                            </div>
                            <div class="col-xs-4 text-center">

                                <button type="button" data-toggle="modal" data-target="#myModal" data-source="#nominee_img"  class="btn btn-sm btn-link set-image">Set Image</button>
                            </div>
                            <div class="col-xs-4 text-center">
                                <img id="nominee_img" style="width:60px;height:60px;" class="text-center" src="images/demo-photo.jpg" alt="">

                            </div>                            
                        </div>


                        <div class="row">
                            <div class="col-sm-12">
                                <hr/>
                                <h6>Marital Status</h6>
                            </div>
                            <div class="input-field col-md-12">
                                <p>
                                    <input name="married" type="radio" id="test1" value="married"/>
                                    <label for="test1">Married</label>
                                </p>
                                <p>
                                    <input name="married" type="radio" id="test2" value="unmarriedr"/>
                                    <label for="test2">UnMarried</label>
                                </p>
                                <p>
                                    <input name="married" type="radio" id="test3" value="single"/>
                                    <label for="test3">Single</label>
                                </p>
                                <p>
                                    <input name="married" type="radio" id="test4" value="divorcee"/>
                                    <label for="test4">Divorcee</label>
                                </p>
                                <hr/>
                            </div>
                        </div>

                        <div class="row">
                            <div class="input-field col-md-12">
                                <input id="occupation_main" type="text" class="validate">
                                <label for="occupation_main">Main Occupation </label>
                            </div>
                        </div>

                        <div class="row">
                            <div class="input-field col-md-12">
                                <input id="occupation_2" type="text" class="validate">
                                <label for="occupation_2">2nd Occupation</label>
                            </div>
                        </div>

                        <div class="row">
                            <div class="input-field col-md-12">
                                <input id="occupation_3" type="text" class="validate">
                                <label for="occupation_3">3rd Occupation </label>
                            </div>
                        </div>


                        <div class="row">
                            <div class="input-field col-md-12">
                                <input id="lat" type="text" class="validate">
                                <label for="last_name">Lat </label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col-md-12">
                                <input id="lon" type="text" class="validate">
                                <label for="last_name">Long </label>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-12">

                                <div class="btn-group btn-group-justified" role="group" aria-label="...">
                                    <div class="btn-group" role="group">
                                        <button type="button" id="save" class="btn btn-primary waves-effect waves-light">Save Changes</button>
                                    </div>
                                    <div class="btn-group" role="group">
                                        <button type="button" id="gps_pos_co" class="btn btn-info waves-effect waves-light">GPS</button>
                                        <!--<button onclick="getLocationPos()" type="button" class="btn btn-info waves-effect waves-light">GPS</button>-->
                                    </div>
                                    <!--                                    <div class="btn-group" role="group">
                                                                            <button type="button" class="btn btn-warning waves-effect waves-light">Start</button>
                                                                        </div>-->
                                    <div class="btn-group" role="group">
                                        <a class="btn btn-warning waves-effect waves-light" href="beneficiary-list.html">List</a>
                                    </div>
                                    <!--                                    <div class="btn-group" role="group">
                                                                            <a class="btn btn-warning waves-effect waves-light" href="camera-capture.html">Check Camera</a>
                                                                        </div>-->

                                    <!--                                    <div class="btn-group" role="group">
                                                                            <button type="button" class="btn btn-danger waves-effect waves-light">Next</button>
                                                                        </div>-->

                                </div>
                            </div>
                            <!--col-sm-12-->
                        </div>
                        <!--  row-->

                    </form>
                    <div class="clearfix"></div>
                </div>
                <!--card-panel-->
            </section>
        </div>


        <!--IMAGE CAPTURE MODAL-->

        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Manage Image</h4>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="image-src-flag">
                        <input type="hidden" id="image-src-val">
                        <div class="row">                           
                            <div class="col-xs-4 text-center">
                                <img id="captured-img" style="width:100px;height:100px;" class="text-center" src="images/demo-photo.jpg" alt="">

                            </div>
                            <div class="col-xs-8 text-center">
                                <hr>
                                <button onclick="capturePhoto();" id="capture-cam" class="btn btn-sm btn-link">Camera</button>
                                <button onclick="getPhoto(pictureSource.SAVEDPHOTOALBUM);" id="capture-lib" class="btn btn-sm btn-link">SDcard</button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default btn-sm" data-dismiss="modal">Done</button>
                        <!--<button type="button" class="btn btn-primary">Save changes</button>-->
                    </div>
                </div>
            </div>
        </div>

<!--container-->
<!-- JQuery -->
<script type="text/javascript" src="js/jquery.min.js"></script>
<!--ng-->
<script type="text/javascript" src="js/angular.min.js"></script>

<!-- cordova -->
<script type="text/javascript" src="cordova.js"></script>

<!-- Bootstrap core JavaScript -->
<script type="text/javascript" src="js/bootstrap.min.js"></script>

<!-- Material Design Bootstrap -->
<script type="text/javascript" src="js/mdb.min.js"></script>

<script type="text/javascript" src="js/custom.js"></script>
<script type="text/javascript" src="js/pg/new-survey-edit.js"></script>

<script type="text/javascript">
var pictureSource;   // picture source
var destinationType; // sets the format of returned value




function getLocationPos() {
    navigator.geolocation.getCurrentPosition(onSuccess, onError);
}

function errorCB(tx, err) {
    alert("Error processing SQL: " + err);
}

function successCB() {

}
function benificiaryDataList(tx, results) {
    var benf_single = '';
    var len = results.rows.length;
    for (var i = 0; i < len; i++) {

        set_input_value_of("#select_id", results.rows.item(i).select_id);
        set_input_value_of("#project_id", results.rows.item(i).project_id);
        set_input_value_of("#office_id", results.rows.item(i).office_id);
        set_input_value_of("#response_by", results.rows.item(i).group_name);
        set_input_value_of("#beneficiary_name", results.rows.item(i).benificiary_name);
        setImgSrc("#benificiaryPhoto", results.rows.item(i).benificiary_img); //img
        set_input_value_of("#nid_num", results.rows.item(i).voter_id);
        setImgSrc("#nid-front", results.rows.item(i).nid_img_front); //img
        setImgSrc("#nid-back", results.rows.item(i).nid_img_back); //img
        set_input_value_of("#fathers_name", results.rows.item(i).fathers_name);
        set_input_value_of("#mothers_name", results.rows.item(i).mothers_name);
        set_input_value_of("#union_name", results.rows.item(i).union_name);
        set_input_value_of("#word_name", results.rows.item(i).word);
        set_input_value_of("#address", results.rows.item(i).address);
        set_input_value_of("#gender", results.rows.item(i).grnder);
        set_input_value_of("#age", results.rows.item(i).age);
        set_input_value_of("#mobile_no", results.rows.item(i).mobile);
        set_input_value_of("#nominee_name", results.rows.item(i).nominee_name);
        set_input_value_of("#nominee_father", results.rows.item(i).nominee_father);
        set_input_value_of("#nominee_mother", results.rows.item(i).nominee_mother);
        set_input_value_of("#relation_with_nom", results.rows.item(i).relation);
        setImgSrc("#nominee_img", results.rows.item(i).nominee_img); //img
        set_radio_value_of("married", results.rows.item(i).marital_sts);
        set_input_value_of("#occupation_main", results.rows.item(i).occupation);
        set_input_value_of("#occupation_2", results.rows.item(i).occupation_1);
        set_input_value_of("#occupation_3", results.rows.item(i).occupation_2);
        var locationGPS = results.rows.item(i).location_gps.split(",");
        set_input_value_of("#lat", locationGPS[0])
        set_input_value_of("#lon", locationGPS[1]);

    }

}
function populateBeneficiarySingle()
{
    var flag = localStorage.getItem("bid-temp");
    var db = window.openDatabase("oxfam_sims_dev", "1.0", "OxfamSIMS", 1000000);
    db.transaction(function (tx) {
        tx.executeSql('SELECT * FROM beneficiary_info WHERE b_id=' + flag, [], benificiaryDataList, errorCB);
    }, errorCB, successCB);
}

function set_input_value_of(inputID, value)
{
    return $(inputID).val(value);
}

function set_option_value_of(inputID, values, value_is)
{
    $.each(values, function (i, value) {
        if (value === value_is)
        {
            $(inputID).append($('<option>').text(value).attr({value: value, selected: "selected"}));
        }
        else
        {
            $(inputID).append($('<option>').text(value).attr({value: value}));
        }
    });
}

function set_radio_value_of(name, value)
{
    return $("input[name=" + name + "][value=" + value + "]").attr('checked', 'checked');
}
function setImgSrc(id, src)
{
    return $(id).attr("src", src);
}
$(document).bind("deviceready", function () {
    populateBeneficiarySingle();



    $('#save').on('touchend', function () {
        var select_id = get_input_value_of("#select_id");
        var project_id = "1";//get_input_value_of("#project_id");
        var office_id = "1"; //get_input_value_of("#office_id");
        var group = get_input_value_of("#response_by");
        var benificiary_name = get_input_value_of("#beneficiary_name");
        var benificiary_img = getImgSrc("#benificiaryPhoto"); //img
        var voter_id = get_input_value_of("#nid_num");
        var nid_front_img = getImgSrc("#nid-front"); //img
        var nid_back_img = getImgSrc("#nid-back"); //img
        var fathers_name = get_input_value_of("#fathers_name");
        var mothers_name = get_input_value_of("#mothers_name");
        var union_name = get_input_value_of("#union_name");
        var word_name = get_input_value_of("#word_name");
        var address = get_input_value_of("#address");
        var gender = get_input_value_of("#gender");
        var age = get_input_value_of("#age");
        var mobile_no = get_input_value_of("#mobile_no");
        var nominee_name = get_input_value_of("#nominee_name");
        var nominee_father = get_input_value_of("#nominee_father");
        var nominee_mother = get_input_value_of("#nominee_mother");
        var relation_with_nom = get_input_value_of("#relation_with_nom");
        var nominee_img = getImgSrc("#nominee_img"); //img
        var marital_status = $("input:radio[name=married]").val();
        var occupation_main = get_input_value_of("#occupation_main");
        var occupation_2 = get_input_value_of("#occupation_2");
        var occupation_3 = get_input_value_of("#occupation_3");
        var location_gps = get_input_value_of("#lat") + "," + get_input_value_of("#lon");
        var flag = localStorage.getItem("bid-temp");
        //word, address, grnder, age, mobile, nominee_name, relation, nominee_img, marital_sts, occupation, occupation_1, occupation_2, location_gps
        var db = window.openDatabase("oxfam_sims_dev", "1.0", "OxfamSIMS", 1000000);
        db.transaction(function (tx) {
            tx.executeSql('UPDATE beneficiary_info SET select_id = ' + select_id + ',project_id = ' + project_id + ',office_id = ' + office_id + ',group_name = ' + group + ',benificiary_name = ' + benificiary_name + ',benificiary_img = ' + benificiary_img + ',voter_id = ' + voter_id + ',nid_img_front = ' + nid_front_img + ',nid_img_back = ' + nid_back_img + ',fathers_name = ' + fathers_name + ', mothers_name = ' + mothers_name + ',union_name = ' + union_name + ',word = ' + word_name + ',address = ' + address + ',grnder = ' + gender + ',age = ' + age + ',mobile = ' + mobile_no + ',nominee_name = ' + nominee_name + ',nominee_father = ' + nominee_father + ',nominee_mother = ' + nominee_mother + ',relation = ' + relation_with_nom + ',nominee_img = ' + nominee_img + ',marital_sts = ' + marital_status + ',occupation = ' + occupation_main + ',occupation_1 = ' + occupation_2 + ',occupation_2 = ' + occupation_3 + ',location_gps = ' + location_gps + ' WHERE b_id=' + flag);
        }, errorCB, successCB);
    });


    $('#gps_pos_co').on('touchend', function () {
        getLocationPos();
    });


    cameraInit();

    $(".set-image").on('touchend', function () {
        var flag = $(this).attr("data-source");
        $("#image-src-flag").val(flag);
    });


    $("#myModal").on('hide.bs.modal', function () {

        var destinationID = $("#image-src-flag").val();
        var sourceVal = $("#image-src-val").val();

        $(destinationID).attr("src", sourceVal);

        $("#image-src-flag").val("");
        $("#image-src-val").val("");
        $("#capture-img").attr("src", "images/demo-photo.jpg");


    });

});
                                    
                                    
//camera only======================================//
function cameraInit() {
    pictureSource = navigator.camera.PictureSourceType;
    destinationType = navigator.camera.DestinationType;
}

// Called when a photo is successfully retrieved
//
function onPhotoDataSuccess(imageData) {
    // Uncomment to view the base64-encoded image data
    // console.log(imageData);

    // Get image handle
    //
    var smallImage = document.getElementById('captured-img');

    // Unhide image elements
    //
    smallImage.style.display = 'block';

    // Show the captured photo
    // The in-line CSS rules are used to resize the image
    //
    smallImage.src = "data:image/jpeg;base64," + imageData;
}

// Called when a photo is successfully retrieved
//
function onPhotoURISuccess(imageURI) {
    // Uncomment to view the image file URI
    // console.log(imageURI);

    // Get image handle
    //
    var largeImage = document.getElementById('captured-img');
    var textField = document.getElementById('image-src-val');

    // Unhide image elements
    //
//                                        largeImage.style.display = 'block';

    // Show the captured photo
    // The in-line CSS rules are used to resize the image
    //
    largeImage.src = imageURI;
    textField.value = imageURI;
}

// A button will call this function
//
function capturePhoto() {
    // Take picture using device camera and retrieve image as base64-encoded string
    navigator.camera.getPicture(onPhotoURISuccess, onFail, {
        quality: 30,
        targetWidth: "512",
        targetHeight: "512",
        destinationType: destinationType.FILE_URI});
}

// A button will call this function
//
function capturePhotoEdit() {
    // Take picture using device camera, allow edit, and retrieve image as base64-encoded string
    navigator.camera.getPicture(onPhotoDataSuccess, onFail, {quality: 20, allowEdit: true,
        destinationType: destinationType.DATA_URL});
}

// A button will call this function
//
function getPhoto(source) {
    // Retrieve image file location from specified source
    navigator.camera.getPicture(onPhotoURISuccess, onFail, {
        quality: 30,
        targetWidth: "512",
        targetHeight: "512",
        destinationType: destinationType.FILE_URI,
        sourceType: source});
}

// Called if something bad happens.
//
function onFail(message) {
    alert('Failed because: ' + message);
}


</script>


    </body>
</html>
