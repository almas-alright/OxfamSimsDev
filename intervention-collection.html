<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
        <title>Home</title>
        <!-- Font Awesome -->
        <link href="css/font-awesome.min.css" rel="stylesheet">
        <!-- Bootstrap -->
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/mdb.min.css" rel="stylesheet">
        <link href="css/style.css" rel="stylesheet">
    </head>

    <body>
        <!-- SideNav slide-out button -->
        <a href="#" data-activates="slide-out" class="navbar-brand button-collapse"><i class="material-icons">menu</i></a>
        <!--/. SideNav slide-out button -->

        <!-- Sidebar navigation -->
        <ul id="slide-out" class="side-nav default-side-nav light-side-nav">
            <!-- Logo -->
            <div class="logo-wrapper text-center">
                <a href="index.html"><img src="images/oxfam-logo.png" alt=""></a>
            </div>

            <!-- Side navigation links -->
            <ul class="collapsible collapsible-accordion">
                <li><a href="project-information.html" class="waves-effect waves-light"><i class="fa fa-info-circle"></i>
                        Project information </a></li>
                <li><a href="beneficiary-survey.html" class="waves-effect waves-light"><i class="fa fa-pencil-square-o"></i>
                        Beneficiary Survey </a></li>
                <li><a href="beneficiary-registration.html" class="waves-effect waves-light"><i class="fa fa-plus"></i>
                        Beneficiary Registration</a></li>
                <li><a href="grant-relief-distribution.html" class="waves-effect waves-light"><i class="fa fa-cubes"></i>
                        Grant/Relief Distribution </a></li>
                <li><a href="post-distribution-monitoring.html" class="waves-effect waves-light"><i class="fa fa-eye"></i> Post
                        Distribution Monitoring </a></li>
                <li><a href="sms-attendance.html" class="waves-effect waves-light"><i class="fa fa-envelope-o"></i> SMS
                        Attendance</a></li>
                <li><a href="my-task.html" class="waves-effect waves-light"><i class="fa fa-tasks"></i> My Task </a></li>
                <li><a href="monitoring-supervision.html" class="waves-effect waves-light"><i class="fa fa-search-plus"></i>
                        Monitoring/Supervision </a></li>
                <li><a href="data-management.html" class="waves-effect waves-light"><i class="fa fa-database"></i> Data
                        Management </a></li>
                <li><a href="operational-settings.html" class="waves-effect waves-light"><i class="fa fa-wrench"></i>
                        Operational SettingsÂ  </a></li>

            </ul>
            <!--/. Side navigation links -->

        </ul>
        <!--/. Sidebar navigation -->
        <nav class="double-navbar navbar navbar-fixed-top light-green darken-3 z-depth-1">

            <div class="container ">


                <header>
                    <div class="row">
                        <div class="col-xs-3 text-center">
                            <div class="navbar-header pull-left">
                                <!-- SideNav slide-out button -->
                                <a href="#" data-activates="slide-out" class="button-collapse"><i class="fa fa-bars"></i></a>
                                <!--/. SideNav slide-out button -->

                            </div>
                        </div>
                        <div class="col-xs-6 text-center">
                            <h4 class="app-title">SIMS</h4>
                        </div>
                        <div class="col-xs-3 text-center"><a href="index.html"><img src="images/oxfam-logo.png" alt=""></a>
                        </div>
                    </div>

                    <!--row-->
                </header>
            </div>
        </nav>
        <div class="container">
            <section class="page-content">


                <div class="row">
                    <div class="col-sm-12">
                        <h5 class="page-title">INTERVENTION COLLECTION Form</h5>

                    </div>
                    <!--col-sm-12-->
                </div>


                <div class="card-panel">

                    <form class="">
                        <div class="row">
                            <div class="input-field col-md-12">
                                <select name="project_id" id="project_id">
                                    <option value="1">project 1</option>
                                    <option value="2">project 2</option>
                                    <option value="3">project 3</option>
                                </select>
                                <label for="project_id">Project</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col-md-12">
                                <select name="office_id" id="office_id">
                                    <option value="1">office 1</option>
                                    <option value="2">office 2</option>
                                    <option value="3">office 3</option>
                                </select>
                                <label for="office_id">Office</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col-md-12">
                                <select name="itn_type_id" id="itn_type_id">
                                    <option value="1">Tube well</option>
                                    <option value="2">Pond</option>
                                    <option value="3">Drain</option>
                                </select>
                                <label for="itn_type_id">Intervention Type</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col-md-12">
                                <input id="intervention_txt_id" type="text" class="validate">
                                <label for="intervention_txt_id">Intervention ID</label>
                            </div>
                        </div>

                        <div class="row">
                            <div class="input-field col-md-12">
                                <input id="itn_name" type="text" class="validate">
                                <label for="itn_name">Intervention Name</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col-md-12">
                                <input id="union_name" type="text" class="validate">
                                <label for="union_name">Union Name</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col-md-12">
                                <input id="word_name" type="text" class="validate">
                                <label for="word_name">Word Name</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col-md-12">
                                <input id="upozilla" type="text" class="validate">
                                <label for="upozilla">Upozilla</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col-md-12">
                                <textarea id="int_address" class="materialize-textarea"></textarea>
                                <label for="textarea1">Full Address</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-12">
                                <h6>Intervention Image</h6>
                            </div>
                            <div class="col-xs-4 text-center">
                                <button type="button" data-toggle="modal" data-target="#myModal" data-source="#intervention_photo"  class="btn btn-sm btn-link set-image">Set Image</button>
                            </div>
                            <div class="col-xs-4 text-center">
                                <img id="intervention_photo" style="width:60px;height:60px;" class="text-center" src="images/demo-photo.jpg" alt="">

                            </div>
                        </div>

                        <div class="row">
                            <div class="input-field col-md-12">
                                <textarea id="description" class="materialize-textarea"></textarea>
                                <label for="textarea1">Description</label>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-sm-12">
                                <h6 class="text-center">GPS Data </h6>
                            </div>

                            <div class="input-field col-md-12">
                                <input type="hidden" id="location_gps" />
                                <div id="geolocation" class="materialize-textarea text-center"></div>                               
                            </div>
                        </div>


                        <div class="row">
                            <div class="col-md-12 text-center">
                                <button type="button" id="get_location" class="btn btn-link">Get GPS</button>
                            </div>
                        </div>

                    </form>
                    <div class="clearfix"></div>
                </div>
                <!--card-panel-->

                <div class="row">
                    <div class="col-lg-12">

                        <div class="btn-group btn-group-justified" role="group" aria-label="...">
                            <div class="btn-group" role="group">
                                <button type="button" id="btn-save" class="btn btn-primary waves-effect waves-light">Save</button>
                            </div>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-info waves-effect waves-light">Load</button>
                            </div>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-warning waves-effect waves-light">Edit</button>
                            </div>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-danger waves-effect waves-light">Del</button>
                            </div>
                            <div class="btn-group" role="group">
                                <a href="intervention-list.html" class="btn btn-default waves-effect waves-light">List</a>
                            </div>
                        </div>
                    </div>
                    <!--col-sm-12-->
                </div>

            </section>
        </div>



        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Manage Image</h4>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="image-src-flag">
                        <input type="hidden" id="image-src-val">
                        <div class="row">                           
                            <div class="col-xs-4 text-center">
                                <img id="captured-img" style="width:100px;height:100px;" class="text-center" src="images/demo-photo.jpg" alt="">

                            </div>
                            <div class="col-xs-8 text-center">
                                <hr>
                                <button onclick="capturePhoto();" id="capture-cam" class="btn btn-sm btn-link">Camera</button>
                                <button onclick="getPhoto(pictureSource.SAVEDPHOTOALBUM);" id="capture-lib" class="btn btn-sm btn-link">SDcard</button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default btn-sm" data-dismiss="modal">Done</button>
                        <!--<button type="button" class="btn btn-primary">Save changes</button>-->
                    </div>
                </div>
            </div>
        </div>

        <!--container-->

        <!-- JQuery -->
        <script type="text/javascript" src="js/jquery.min.js"></script>
        <script type="text/javascript" src="cordova.js"></script>
        <!-- Bootstrap core JavaScript -->
        <script type="text/javascript" src="js/bootstrap.min.js"></script>
        <!-- Material Design Bootstrap -->
        <script type="text/javascript" src="js/mdb.min.js"></script>
        <script type="text/javascript" src="js/custom.js"></script>



        <script type="text/javascript" charset="utf-8">

                                    var pictureSource;   // picture source
                                    var destinationType; // sets the format of returned value

                                    // Wait for device API libraries to load
                                    //
                                    $(document).bind("deviceready", function () {
                                        cameraInit();

                                        $(".set-image").on('touchend', function () {
                                            var flag = $(this).attr("data-source");
                                            $("#image-src-flag").val(flag);
                                        });

                                        $("#get_location").on('touchstart', function () {
                                            onLocationReady();
                                        }).on('touchend', function () {
                                            var preVal = $('#location_gps').val();
                                            $('#location_gps').val(preVal.replace(/^,|,$/g, ''));
                                            $('#geolocation').html(preVal);
                                        });


                                        $("#myModal").on('hide.bs.modal', function () {

                                            var destinationID = $("#image-src-flag").val();
                                            var sourceVal = $("#image-src-val").val();

                                            $(destinationID).attr("src", sourceVal);

                                            $("#image-src-flag").val("");
                                            $("#image-src-val").val("");
                                            $("#capture-img").attr("src", "images/demo-photo.jpg");


                                        });

//                                        saving data
                                        $("#btn-save").on('touchend', function () {
                                            var project_id = get_input_value_of("#project_id");
                                            var office_id = get_input_value_of("#office_id");
                                            var itn_type_id = get_input_value_of("#itn_type_id");
                                            var intervention_txt_id = get_input_value_of("#intervention_txt_id");
                                            var itn_name = get_input_value_of("#itn_name");
                                            var union_name = get_input_value_of("#union_name");
                                            var word_name = get_input_value_of("#word_name");
                                            var upozilla = get_input_value_of("#upozilla");
                                            var int_address = get_input_value_of("#int_address");
                                            var description = get_input_value_of("#description");
                                            var intervention_photo = getImgSrc("#intervention_photo");
                                            var location_gps = get_input_value_of("#location_gps");

                                            var db = window.openDatabase("oxfam_sims_dev", "1.0", "OxfamSIMS", 1000000);
                                            db.transaction(function (tx) {
                                                tx.executeSql('INSERT INTO intervention_list (intervention_txt_id,project_id,office_id,intervention_type,intervention_name,union_name,word,upazilla,address,descriptoin,intervention_photo,location_gps,status) VALUES ("' + intervention_txt_id + '","' + project_id + '","' + office_id + '","' + itn_type_id + '","' + itn_name + '","' + union_name + '","' + word_name + '","' + upozilla + '","' + int_address + '","' + description + '","' + intervention_photo + '","' + location_gps + '", "0")');
                                            }, errorCB, successRedir);
                                        });

                                    });

                                    // device APIs are available
                                    //
                                    function cameraInit() {
                                        pictureSource = navigator.camera.PictureSourceType;
                                        destinationType = navigator.camera.DestinationType;
                                    }

                                    // Called when a photo is successfully retrieved
                                    //
                                    function onPhotoDataSuccess(imageData) {
                                        // Uncomment to view the base64-encoded image data
                                        // console.log(imageData);

                                        // Get image handle
                                        //
                                        var smallImage = document.getElementById('captured-img');

                                        // Unhide image elements
                                        //
                                        smallImage.style.display = 'block';

                                        // Show the captured photo
                                        // The in-line CSS rules are used to resize the image
                                        //
                                        smallImage.src = "data:image/jpeg;base64," + imageData;
                                    }

                                    // Called when a photo is successfully retrieved
                                    //
                                    function onPhotoURISuccess(imageURI) {
                                        // Uncomment to view the image file URI
                                        // console.log(imageURI);

                                        // Get image handle
                                        //
                                        var largeImage = document.getElementById('captured-img');
                                        var textField = document.getElementById('image-src-val');

                                        // Unhide image elements
                                        //
                                        //largeImage.style.display = 'block';

                                        // Show the captured photo
                                        // The in-line CSS rules are used to resize the image
                                        //
                                        largeImage.src = imageURI;
                                        textField.value = imageURI;
                                    }

                                    // A button will call this function
                                    //
                                    function capturePhoto() {
                                        // Take picture using device camera and retrieve image as base64-encoded string
                                        navigator.camera.getPicture(onPhotoURISuccess, onFail, {quality: 50,
                                            destinationType: destinationType.FILE_URI});
                                    }

                                    // A button will call this function
                                    //
                                    function capturePhotoEdit() {
                                        // Take picture using device camera, allow edit, and retrieve image as base64-encoded string
                                        navigator.camera.getPicture(onPhotoDataSuccess, onFail, {quality: 20, allowEdit: true,
                                            destinationType: destinationType.DATA_URL});
                                    }

                                    // A button will call this function
                                    //
                                    function getPhoto(source) {
                                        // Retrieve image file location from specified source
                                        navigator.camera.getPicture(onPhotoURISuccess, onFail, {quality: 50,
                                            destinationType: destinationType.FILE_URI,
                                            sourceType: source});
                                    }

                                    // Called if something bad happens.
                                    //
                                    function onFail(message) {
                                        alert('Failed because: ' + message);
                                    }



                                    //geo location

                                    function onLocationReady() {
                                        navigator.geolocation.getCurrentPosition(locSuccess, onError);
                                    }
                                    function locSuccess(position) {
                                        var curVal = $('#location_gps').val();
                                        curVal += ',' + position.coords.latitude + '|' + position.coords.longitude;
                                        $('#location_gps').val(curVal);
                                    }

                                    // onError Callback receives a PositionError object
                                    //
                                    function onError(error) {
                                        alert('code: ' + error.code + '\n' +
                                                'message: ' + error.message + '\n');
                                    }

                                    function successRedir()
                                    {
                                        window.location = "intervention-list.html";
                                    }



//  `id` 
//  `intervention_type_id` 
//  `project_id` 
//  `office_id` 
//  `intervention_name` 
//  `ward` 
//  `upazilla` 
//  `address` 
//  `description` 
//  `intervention_photo` 
//  `lat` 
//  `lng`

        </script>

    </body>
</html>
